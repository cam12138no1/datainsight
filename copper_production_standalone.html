<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>全球铜矿产量追踪</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;600;700&display=swap');
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Noto Sans SC', -apple-system, sans-serif;
      background: #f5f5f5;
      min-height: 100vh;
      padding: 20px;
      color: #333;
      font-size: 12px;
    }
    
    .page {
      max-width: 1800px;
      margin: 0 auto;
      background: #fff;
      box-shadow: 0 2px 12px rgba(0,0,0,0.1);
      padding: 24px;
      border-radius: 4px;
    }
    
    .header {
      border-bottom: 2px solid #c00;
      padding-bottom: 12px;
      margin-bottom: 20px;
    }
    
    .header h1 {
      font-size: 18px;
      font-weight: 700;
      color: #c00;
      margin-bottom: 4px;
    }
    
    .header .subtitle {
      font-size: 11px;
      color: #666;
    }
    
    .section {
      margin-bottom: 24px;
    }
    
    .section-title {
      font-size: 13px;
      font-weight: 600;
      color: #c00;
      margin-bottom: 8px;
      padding: 4px 8px;
      background: #fff5f5;
      border-left: 3px solid #c00;
    }
    
    .table-wrapper {
      overflow-x: auto;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
      white-space: nowrap;
    }
    
    th, td {
      padding: 4px 6px;
      text-align: right;
      border: 1px solid #ddd;
    }
    
    th {
      background: #f8f8f8;
      font-weight: 600;
      color: #333;
      position: sticky;
      top: 0;
    }
    
    td:first-child {
      text-align: left;
      font-weight: 600;
      background: #fafafa;
      color: #c00;
      position: sticky;
      left: 0;
      z-index: 2;
      min-width: 100px;
    }
    
    th.sticky-col {
      text-align: left;
      font-weight: 600;
      background: #fafafa;
      color: #c00;
      position: sticky;
      left: 0;
      z-index: 3;
      min-width: 100px;
    }
    
    tbody tr:hover { background: #fffef5; }
    
    .col-2024 { background: #fff9c4 !important; }
    .cell-na { color: #bbb; }
    
    .row-total {
      background: #ffebee !important;
      font-weight: 700;
    }
    .row-total td { background: #ffebee !important; }
    .row-total td:first-child { color: #c00; }
    
    .footer {
      margin-top: 20px;
      padding-top: 12px;
      border-top: 1px solid #eee;
      font-size: 10px;
      color: #888;
      text-align: center;
    }
    
    .header-group {
      background: #e3f2fd !important;
      text-align: center !important;
      font-weight: 700;
      color: #1565c0;
    }
    
    .header-forecast-q3 { background: #fff9c4 !important; }
    .header-forecast-q2 { background: #c8e6c9 !important; }
    .header-forecast-q1 { background: #ffe0b2 !important; }
    
    @media print {
      body { background: #fff; padding: 0; }
      .page { box-shadow: none; padding: 10px; }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    // 公司顺序：英美资源、安托法加斯塔、自由港、第一量子、嘉能可
    const COMPANIES = {
      'AAL': { name: '英美资源', region: '英国' },
      'ANTO': { name: '安托法加斯塔', region: '智利' },
      'FCX': { name: '自由港', region: '美洲' },
      'FQM': { name: '第一量子', region: '加拿大' },
      'GLEN': { name: '嘉能可', region: '瑞士' },
    };
    
    // 静态数据 - 季度产量 (57条) - 严格来自数据库
    const QUARTERLY_DATA = {
      "AAL": {
        2023: { "Q1": 17.81, "Q2": 20.91, "Q3": 20.91, "Q4": 22.99 },
        2024: { "Q1": 19.81, "Q2": 19.57, "Q3": 18.13, "Q4": 19.75 },
        2025: { "Q1": 16.89, "Q2": 17.30, "Q3": 18.35 }
      },
      "ANTO": {
        2023: { "Q1": 14.59, "Q2": 14.96, "Q3": 17.36, "Q4": 19.15 },
        2024: { "Q1": 12.94, "Q2": 15.53, "Q3": 17.90, "Q4": 20.03 },
        2025: { "Q1": 15.47, "Q2": 16.01, "Q3": 16.18, "Q4": 17.70 }
      },
      "FCX": {
        2023: { "Q1": 43.77, "Q2": 48.40, "Q3": 49.21, "Q4": 49.12 },
        2024: { "Q1": 49.21, "Q2": 47.04, "Q3": 47.67, "Q4": 46.58 },
        2025: { "Q1": 39.37, "Q2": 43.69, "Q3": 41.37, "Q4": 29.03 }
      },
      "FQM": {
        2023: { "Q1": 13.88, "Q2": 18.72, "Q3": 22.16, "Q4": 16.02 },
        2024: { "Q1": 10.06, "Q2": 10.27, "Q3": 11.61, "Q4": 11.16 },
        2025: { "Q1": 9.97, "Q2": 9.11, "Q3": 10.46 }
      },
      "GLEN": {
        2023: { "Q1": 24.41, "Q2": 24.39, "Q3": 24.78, "Q4": 27.43 },
        2024: { "Q1": 23.97, "Q2": 22.29, "Q3": 24.26, "Q4": 24.64 },
        2025: { "Q1": 16.79, "Q2": 17.60, "Q3": 23.96 }
      }
    };
    
    // 静态数据 - 年度产量 (16条) - 严格来自数据库
    const ANNUAL_DATA = {
      "AAL": [
        { year: 2023, production_wt: 82.62 },
        { year: 2024, production_wt: 77.27 }
      ],
      "ANTO": [
        { year: 2022, production_wt: 64.62 },
        { year: 2023, production_wt: 66.06 },
        { year: 2024, production_wt: 66.40 },
        { year: 2025, production_wt: 65.37 }
      ],
      "FCX": [
        { year: 2023, production_wt: 190.51 },
        { year: 2024, production_wt: 190.51 },
        { year: 2025, production_wt: 154.24 }
      ],
      "FQM": [
        { year: 2022, production_wt: 77.59 },
        { year: 2023, production_wt: 70.77 },
        { year: 2024, production_wt: 43.10 }
      ],
      "GLEN": [
        { year: 2022, production_wt: 105.80 },
        { year: 2023, production_wt: 101.01 },
        { year: 2024, production_wt: 95.16 },
        { year: 2025, production_wt: 85.16 }
      ]
    };
    
    // 静态数据 - 预测数据 (47条) - 严格来自数据库
    const FORECAST_DATA = {
      "AAL": [
        { report_quarter: "2023Q1", forecast_year: 2023, production_wt: 88.50 },
        { report_quarter: "2023Q4", forecast_year: 2024, production_wt: 76.00 },
        { report_quarter: "2024Q1", forecast_year: 2024, production_wt: 76.00 },
        { report_quarter: "2024Q2", forecast_year: 2024, production_wt: 76.00 },
        { report_quarter: "2024Q4", forecast_year: 2025, production_wt: 72.00 },
        { report_quarter: "2024Q4", forecast_year: 2026, production_wt: 79.00 },
        { report_quarter: "2024Q4", forecast_year: 2027, production_wt: 79.00 },
        { report_quarter: "2025Q1", forecast_year: 2025, production_wt: 72.00 },
        { report_quarter: "2025Q2", forecast_year: 2025, production_wt: 72.00 },
        { report_quarter: "2025Q2", forecast_year: 2026, production_wt: 79.00 },
        { report_quarter: "2025Q2", forecast_year: 2027, production_wt: 79.00 },
        { report_quarter: "2025Q3", forecast_year: 2025, production_wt: 72.00 }
      ],
      "ANTO": [
        { report_quarter: "2023Q1", forecast_year: 2023, production_wt: 69.00 },
        { report_quarter: "2023Q3", forecast_year: 2024, production_wt: 69.00 },
        { report_quarter: "2023Q4", forecast_year: 2024, production_wt: 69.00 },
        { report_quarter: "2024Q3", forecast_year: 2025, production_wt: 68.00 },
        { report_quarter: "2024Q4", forecast_year: 2025, production_wt: 68.00 },
        { report_quarter: "2025Q1", forecast_year: 2025, production_wt: 68.00 },
        { report_quarter: "2025Q2", forecast_year: 2025, production_wt: 68.00 },
        { report_quarter: "2025Q3", forecast_year: 2026, production_wt: 67.50 },
        { report_quarter: "2025Q4", forecast_year: 2026, production_wt: 67.50 }
      ],
      "FCX": [
        { report_quarter: "2023Q1", forecast_year: 2023, production_wt: 184.07 },
        { report_quarter: "2023Q2", forecast_year: 2024, production_wt: 190.51 },
        { report_quarter: "2023Q2", forecast_year: 2025, production_wt: 190.51 },
        { report_quarter: "2023Q4", forecast_year: 2024, production_wt: 186.06 },
        { report_quarter: "2023Q4", forecast_year: 2025, production_wt: 190.51 },
        { report_quarter: "2023Q4", forecast_year: 2026, production_wt: 195.05 },
        { report_quarter: "2024Q3", forecast_year: 2024, production_wt: 184.00 },
        { report_quarter: "2025Q3", forecast_year: 2025, production_wt: 158.76 }
      ],
      "FQM": [
        { report_quarter: "2023Q1", forecast_year: 2023, production_wt: 80.50 },
        { report_quarter: "2023Q4", forecast_year: 2024, production_wt: 39.50 },
        { report_quarter: "2023Q4", forecast_year: 2025, production_wt: 43.00 },
        { report_quarter: "2023Q4", forecast_year: 2026, production_wt: 43.00 },
        { report_quarter: "2024Q1", forecast_year: 2024, production_wt: 39.50 },
        { report_quarter: "2024Q4", forecast_year: 2025, production_wt: 41.00 },
        { report_quarter: "2024Q4", forecast_year: 2026, production_wt: 42.00 },
        { report_quarter: "2024Q4", forecast_year: 2027, production_wt: 46.00 },
        { report_quarter: "2025Q1", forecast_year: 2025, production_wt: 41.00 }
      ],
      "GLEN": [
        { report_quarter: "2023Q1", forecast_year: 2023, production_wt: 104.00 },
        { report_quarter: "2023Q2", forecast_year: 2023, production_wt: 104.00 },
        { report_quarter: "2023Q3", forecast_year: 2023, production_wt: 104.00 },
        { report_quarter: "2024Q1", forecast_year: 2024, production_wt: 98.00 },
        { report_quarter: "2024Q2", forecast_year: 2024, production_wt: 98.00 },
        { report_quarter: "2024Q3", forecast_year: 2024, production_wt: 98.00 },
        { report_quarter: "2025Q1", forecast_year: 2025, production_wt: 88.00 },
        { report_quarter: "2025Q2", forecast_year: 2025, production_wt: 87.00 },
        { report_quarter: "2025Q3", forecast_year: 2025, production_wt: 86.25 }
      ]
    };
    
    // 年度产量 + 预测矩阵表格
    function AnnualForecastTable({ companies, annualData, forecastData }) {
      const years = [2022, 2023, 2024, 2025];
      const forecastYears = [2023, 2024, 2025, 2026, 2027];
      // 数据库中实际存在的预测季度
      const forecastQuarters = ['2025Q4', '2025Q3', '2025Q2', '2025Q1', '2024Q4', '2024Q3', '2024Q2', '2024Q1', '2023Q4', '2023Q3', '2023Q2', '2023Q1'];
      
      const companyList = Object.keys(companies || {});
      
      const getAnnual = (company, year) => {
        const data = annualData && annualData[company];
        if (!data) return null;
        const found = data.find(d => d.year === year);
        return found ? found.production_wt : null;
      };
      
      const getForecast = (company, reportQuarter, targetYear) => {
        const data = forecastData && forecastData[company];
        if (!data) return null;
        const found = data.find(d => d.report_quarter === reportQuarter && d.forecast_year === targetYear);
        return found ? found.production_wt : null;
      };
      
      const calcTotal = (getter, ...args) => {
        let sum = 0;
        let hasData = false;
        companyList.forEach(c => {
          const val = getter(c, ...args);
          if (val !== null) {
            sum += val;
            hasData = true;
          }
        });
        return hasData ? sum : null;
      };
      
      return (
        <div className="table-wrapper">
          <table>
            <thead>
              <tr>
                <th rowSpan="2" className="sticky-col">公司</th>
                {years.map(y => <th key={y} rowSpan="2" className={y === 2025 ? 'col-2024' : ''}>{y}</th>)}
                {forecastQuarters.map(fq => (
                  <th key={fq} colSpan="5" className={`header-group ${fq.includes('2025') ? 'header-forecast-q3' : fq.includes('2024') ? 'header-forecast-q2' : 'header-forecast-q1'}`}>
                    基于{fq}预测
                  </th>
                ))}
              </tr>
              <tr>
                {forecastQuarters.map((fq) => 
                  forecastYears.map((fy) => (
                    <th key={`${fq}-${fy}`} className={
                      fq.includes('2025') ? 'header-forecast-q3' :
                      fq.includes('2024') ? 'header-forecast-q2' : 'header-forecast-q1'
                    }>{fy}</th>
                  ))
                )}
              </tr>
            </thead>
            <tbody>
              {companyList.map(company => {
                const info = COMPANIES[company] || { name: company };
                return (
                  <tr key={company}>
                    <td>{info.name}</td>
                    {years.map(y => {
                      const val = getAnnual(company, y);
                      return (
                        <td key={y} className={y === 2025 ? 'col-2024' : ''}>
                          {val !== null ? val.toFixed(1) : <span className="cell-na">-</span>}
                        </td>
                      );
                    })}
                    {forecastQuarters.map((fq) => 
                      forecastYears.map(fy => {
                        const val = getForecast(company, fq, fy);
                        const bgClass = fq.includes('2025') ? 'header-forecast-q3' :
                                       fq.includes('2024') ? 'header-forecast-q2' : 'header-forecast-q1';
                        return (
                          <td key={`${fq}-${fy}`} className={bgClass}>
                            {val !== null ? val.toFixed(1) : <span className="cell-na">-</span>}
                          </td>
                        );
                      })
                    )}
                  </tr>
                );
              })}
              <tr className="row-total">
                <td>产量（万吨）</td>
                {years.map(y => {
                  const total = calcTotal(getAnnual, y);
                  return (
                    <td key={y} className={y === 2025 ? 'col-2024' : ''}>
                      {total !== null ? total.toFixed(1) : '-'}
                    </td>
                  );
                })}
                {forecastQuarters.map((fq) => 
                  forecastYears.map(fy => {
                    const total = calcTotal(getForecast, fq, fy);
                    const bgClass = fq.includes('2025') ? 'header-forecast-q3' :
                                   fq.includes('2024') ? 'header-forecast-q2' : 'header-forecast-q1';
                    return (
                      <td key={`${fq}-${fy}`} className={bgClass}>
                        {total !== null ? total.toFixed(1) : '-'}
                      </td>
                    );
                  })
                )}
              </tr>
            </tbody>
          </table>
        </div>
      );
    }
    
    // 季度产量表格
    function QuarterlyTable({ companies, quarterlyData }) {
      const years = [2023, 2024, 2025];
      const quarters = ['Q1', 'Q2', 'Q3', 'Q4'];
      
      const quarterCols = [];
      for (const year of years) {
        for (const q of quarters) {
          quarterCols.push({ year, q, label: `${q.slice(1)}Q${String(year).slice(2)}` });
        }
      }
      
      const companyList = Object.keys(companies || {});
      
      const getQuarter = (company, year, quarter) => {
        const data = quarterlyData && quarterlyData[company];
        if (!data || !data[year] || data[year][quarter] === undefined) return null;
        return data[year][quarter];
      };
      
      const calcTotal = (year, quarter) => {
        let sum = 0;
        let hasData = false;
        companyList.forEach(c => {
          const val = getQuarter(c, year, quarter);
          if (val !== null) {
            sum += val;
            hasData = true;
          }
        });
        return hasData ? sum : null;
      };
      
      return (
        <div className="table-wrapper">
          <table>
            <thead>
              <tr>
                <th className="sticky-col">公司</th>
                {quarterCols.map((col, i) => (
                  <th key={i} className={col.year === 2025 ? 'col-2024' : ''}>
                    {col.label}
                  </th>
                ))}
              </tr>
            </thead>
            <tbody>
              {companyList.map(company => {
                const info = COMPANIES[company] || { name: company };
                return (
                  <tr key={company}>
                    <td>{info.name}</td>
                    {quarterCols.map((col, i) => {
                      const val = getQuarter(company, col.year, col.q);
                      return (
                        <td key={i} className={col.year === 2025 ? 'col-2024' : ''}>
                          {val !== null ? val.toFixed(1) : <span className="cell-na">-</span>}
                        </td>
                      );
                    })}
                  </tr>
                );
              })}
              <tr className="row-total">
                <td>产量（万吨）</td>
                {quarterCols.map((col, i) => {
                  const total = calcTotal(col.year, col.q);
                  return (
                    <td key={i} className={col.year === 2025 ? 'col-2024' : ''}>
                      {total !== null ? total.toFixed(1) : '-'}
                    </td>
                  );
                })}
              </tr>
            </tbody>
          </table>
        </div>
      );
    }
    
    function App() {
      const data = {
        companies: COMPANIES,
        quarterly: QUARTERLY_DATA,
        annual: ANNUAL_DATA,
        forecasts: FORECAST_DATA
      };
      
      return (
        <div className="page">
          <div className="header">
            <h1>全球主要铜矿企业产量追踪报告</h1>
            <div className="subtitle">
              数据来源: 公司财报 (PDF) | 单位: 万吨 | 更新时间: 2026-02-05
            </div>
          </div>
          
          <div className="section">
            <div className="section-title">一、年度产量与预测矩阵</div>
            <AnnualForecastTable 
              companies={data.companies} 
              annualData={data.annual}
              forecastData={data.forecasts}
            />
          </div>
          
          <div className="section">
            <div className="section-title">二、季度铜产量明细</div>
            <QuarterlyTable 
              companies={data.companies} 
              quarterlyData={data.quarterly}
            />
          </div>
          
          <div className="footer">
            数据来源: 公司财报 (10-K/10-Q/年报/季报) | AI提取: Claude Opus 4.5 | 
            覆盖公司: FCX, AAL, ANTO, FQM, GLEN | 季度57条 | 年度16条 | 预测47条 | 数据已与PDF原文100%核对
          </div>
        </div>
      );
    }
    
    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
